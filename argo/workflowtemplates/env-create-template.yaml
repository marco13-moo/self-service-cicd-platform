apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: env-create-template
spec:
  entrypoint: create-namespace
  arguments:
    parameters:
      - name: env_name
      - name: service
      - name: expires_at
  templates:
    - name: create-namespace
      script:
        image: bitnami/kubectl:1.29
        command: [sh]
        source: |
          set -e

          echo "Ensuring namespace {{workflow.parameters.env_name}} exists"

          kubectl get namespace {{workflow.parameters.env_name}} \
            || kubectl create namespace {{workflow.parameters.env_name}}

          kubectl label namespace {{workflow.parameters.env_name}} \
            service={{workflow.parameters.service}} \
            managed-by=self-service-cicd \
            --overwrite